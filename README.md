# MoneyMind (Android)

혼자 쓰는 용도의 안드로이드 가계부 MVP입니다.

## 포함 기능

- 알림 기반 거래 수집:
  - `NotificationListenerService` 알림 파싱 후 Room DB에 직접 적재
  - 금융앱 패키지 allowlist + 중복 알림 필터 적용
- 파일 읽기:
  - `CSV`, `XLS/XLSX`, `PPF/PDF` 명세서 파싱
- 파일 내보내기:
  - `CSV`만 지원 (2종: 은행용, 분석용)
- 자동 분류:
  - 수입/지출/내부이체 분리
  - 키워드 기반 카테고리 분류
  - 반복 결제 패턴 기반 구독 추정
  - `할부` 텍스트 패턴 감지
- 계좌이체 제외 규칙:
  - 본인 소유 계좌 간 이동으로 판단되면 `TRANSFER` 처리
  - 월 지출 합계에서 자동 제외
- 할부 주의:
  - 등록된 할부 계획을 월별 경고로 표시
- 영속화:
  - `Room` DB에 거래/소유계좌/소유자별칭/할부계획 저장

## 내부이체(소비 노카운팅) 규칙

`InternalTransferDetector`가 아래 중 하나를 만족하면 내부이체로 처리합니다.

1. `fromAccount`와 `toAccount`가 모두 내 소유 계좌
2. 설명에 이체 키워드가 있고, 상대 이름이 내 별칭/소유자 이름과 일치

내부이체는 `EntryType.TRANSFER`로 저장되며 지출 합계 계산에서 제외됩니다.

## 저장 구조 (Room)

- `ledger_entries`: 분류 완료 거래 원장
- `owned_accounts`: 내 소유 계좌
- `owner_aliases`: 동명이인/본인 판별용 별칭
- `installment_plans`: 수동 등록한 할부 계획

알림 수집과 파일 가져오기는 같은 분류 파이프라인을 거친 뒤 `ledger_entries`에 저장됩니다.
중복 방지는 fingerprint 기반으로 처리되며 동일 배치 중복도 함께 제외됩니다.
DB 스키마 업데이트는 마이그레이션(1 -> 2)으로 처리하여 기존 데이터가 유지됩니다.

## 파일 가져오기 규칙

- CSV/XLSX: 헤더 이름을 유사 키로 매핑 (`거래일`, `적요`, `출금액`, `입금액`, `금액` 등)
- PPF/PDF: 텍스트 라인에서 `날짜 + 설명 + 금액` 패턴 추출
- 형식 감지 우선순위: 확장자 -> MIME -> 파일 헤더 시그니처

은행/카드사마다 양식이 달라서, 실제 사용 시 은행별 파서 보강이 필요합니다.

## 사용 순서

1. 앱에서 본인 별칭과 내 계좌를 먼저 등록
2. `읽기: CSV/엑셀/PPF`로 과거 내역(CSV/XLSX/PPF/PDF) 입력
3. 안드로이드 설정에서 알림 접근 권한에 `MoneyMind` 허용
4. 필요 시 `내보내기: 은행용 CSV` 또는 `내보내기: 분석 CSV` 실행
5. 이후 들어오는 소비/수입 알림은 자동 저장

## 빌드 참고

- OneDrive 경로 잠금 이슈를 피하기 위해 Gradle 빌드 산출물은 `C:/temp/moneymind-build` 아래에 생성됩니다.

## 다음 보강 추천

1. 은행/카드사별 파서 템플릿 세분화
2. 사용자 수동 교정값 기반 분류 학습
3. 백업/복원 자동화(스케줄 백업, 클라우드 연동) 추가
